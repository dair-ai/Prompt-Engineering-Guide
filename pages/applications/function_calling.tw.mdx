# ä½¿ç”¨ LLM é€²è¡Œ Function Calling

import {Cards, Card, Callout} from 'nextra-theme-docs'
import {CodeIcon} from 'components/icons'

## å…¥é–€ï¼šä»€éº¼æ˜¯ Function Callingï¼Ÿ

<iframe width="100%"
  height="415px"
  src="https://www.youtube.com/embed/p0I-hwZSWMs?si=tQgi-LiHe6Oj_rzm" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
  />


Function calling æŒ‡çš„æ˜¯ï¼šè®“å¤§å‹èªè¨€æ¨¡å‹ï¼ˆLLMï¼‰**å¯é åœ°å‘¼å«å¤–éƒ¨å·¥å…·æˆ– API** çš„èƒ½åŠ›ã€‚
æ¨¡å‹æœƒåˆ¤æ–·ã€Œæ˜¯å¦éœ€è¦å‘¼å«æŸå€‹å‡½å¼ã€ï¼Œä¸¦è¼¸å‡ºä¸€æ®µ JSONï¼Œå…§å®¹åŒ…å«è©²å‡½å¼æ‰€éœ€çš„åƒæ•¸ã€‚

ä»¥ GPT-4 / GPT-3.5 ç‚ºä¾‹ï¼Œå®ƒå€‘å·²é‡å°é€™ç¨®ç”¨æ³•åšéå¾®èª¿ï¼š
åœ¨å°è©±ä¸­åµæ¸¬å‡ºéœ€è¦å‘¼å«å‡½å¼æ™‚ï¼Œæœƒè‡ªå‹•ç”¢ç”Ÿå°æ‡‰çš„ `tool_calls` èˆ‡åƒæ•¸ã€‚ä½ å¯ä»¥åœ¨ä¸€æ¬¡è«‹æ±‚ä¸­å®šç¾©å¤šå€‹å‡½å¼ï¼Œè®“æ¨¡å‹é¸æ“‡æœ€é©åˆçš„å·¥å…·ã€‚

Function calling å°ä»¥ä¸‹æƒ…å¢ƒç‰¹åˆ¥é—œéµï¼š

- å»ºæ§‹éœ€è¦æŸ¥è©¢å¤–éƒ¨è„ˆçµ¡çš„èŠå¤©æ©Ÿå™¨äººæˆ–ä»£ç†ï¼ˆagentsï¼‰
- å°‡è‡ªç„¶èªè¨€è½‰æˆ API å‘¼å«æˆ–è³‡æ–™åº«æŸ¥è©¢
- è®“æ¨¡å‹ã€ŒçœŸçš„å»å¤–éƒ¨ç³»çµ±å–è³‡æ–™ã€ï¼Œè€Œä¸æ˜¯åªæ†‘è¨“ç·´çŸ¥è­˜çŒœç­”æ¡ˆ

## ä»¥ GPT-4 ç‚ºä¾‹çš„åŸºæœ¬æµç¨‹

å‡è¨­ä½¿ç”¨è€…å•ï¼š

```text
What is the weather like in London?
```

å–®é  LLM æœ¬èº«æ˜¯ç„¡æ³•å–å¾—å³æ™‚å¤©æ°£çš„ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦ï¼š

1. å®šç¾©ä¸€å€‹ `get_current_weather` å‡½å¼ä½œç‚ºå·¥å…·
2. æŠŠå‡½å¼å®šç¾©éš¨åŒå°è©±ä¸€ä½µé€é€²æ¨¡å‹
3. è®“æ¨¡å‹æ±ºå®šæ˜¯å¦è¦å‘¼å«è©²å‡½å¼ï¼Œä»¥åŠè¦å¸¶å…¥å“ªäº›åƒæ•¸

å‡½å¼å®šç¾©å¤§è‡´å¦‚ä¸‹ï¼š

```python
tools = [
    {
        "type": "function",
        "function": {
            "name": "get_current_weather",
            "description": "Get the current weather in a given location",
            "parameters": {
                "type": "object",
                "properties": {
                    "location": {
                        "type": "string",
                        "description": "The city and state, e.g. San Francisco, CA",
                    },
                    "unit": {
                        "type": "string",
                        "enum": ["celsius", "fahrenheit"]},
                },
                "required": ["location"],
            },
        },
    }
]
```

ä½ å¯ä»¥å…ˆå®šç¾©ä¸€å€‹ completion å‡½å¼ï¼š

```python
def get_completion(messages, model="gpt-3.5-turbo-1106", temperature=0, max_tokens=300, tools=None):
    response = openai.chat.completions.create(
        model=model,
        messages=messages,
        temperature=temperature,
        max_tokens=max_tokens,
        tools=tools
    )
    return response.choices[0].message
```

æ¥è‘—é€™æ¨£çµ„è£ä½¿ç”¨è€…å•é¡Œï¼š

```python
messages = [
    {
        "role": "user",
        "content": "What is the weather like in London?"
    }
]
```

æœ€å¾Œå‘¼å«ä¸Šé¢çš„ `get_completion`ï¼Œä¸¦åŒæ™‚å‚³å…¥ `messages` èˆ‡ `tools`ï¼š

```python
response = get_completion(messages, tools=tools)
```

`response` ç‰©ä»¶å…§å®¹å¦‚ä¸‹ï¼š

```python
ChatCompletionMessage(
  content=None,
  role='assistant',
  function_call=None,
  tool_calls=[
    ChatCompletionMessageToolCall(
      id='...',
      function=Function(
        arguments='{\"location\":\"London\",\"unit\":\"celsius\"}',
        name='get_current_weather'
      ),
      type='function'
    )
  ]
)
```

æˆ‘å€‘å¯ä»¥å¾ `arguments` ä¸­å–å‡º `location` èˆ‡ `unit`ï¼Œè‡ªè¡Œå‘¼å«å¤–éƒ¨å¤©æ°£ APIï¼Œå–å¾—çµæœå¾Œå†æŠŠå¯¦éš›å¤©æ°£è³‡è¨Šå›å‚³çµ¦æ¨¡å‹ï¼Œè«‹å®ƒç”¢ç”Ÿä¸€æ®µå°ä½¿ç”¨è€…å‹å–„çš„è‡ªç„¶èªè¨€èªªæ˜ã€‚

## Notebook ç¯„ä¾‹

<Callout type= "info" emoji="ğŸ“">
å¦‚æœæƒ³æ·±å…¥äº†è§£ function calling çš„å¯¦ä½œç´°ç¯€ï¼Œæ­¡è¿åƒè€ƒæˆ‘å€‘çš„ AI èª²ç¨‹ã€‚[ç«‹å³åŠ å…¥ï¼](https://dair-ai.thinkific.com/)
çµå¸³æ™‚è¼¸å…¥å„ªæƒ ç¢¼ PROMPTING20ï¼Œå¯é¡å¤–äº«æœ‰ 8 æŠ˜å„ªæƒ ã€‚
</Callout>

ä»¥ä¸‹ notebook ç¤ºç¯„å¦‚ä½•åœ¨ OpenAI API ä¸­ä½¿ç”¨ function callingï¼š

<Cards>
    <Card
        icon={<CodeIcon />}
        title="Function Calling with OpenAI APIs"
        href="https://github.com/dair-ai/Prompt-Engineering-Guide/blob/main/notebooks/pe-function-calling.ipynb"
    />
</Cards>

## é–‹æºæ¨¡å‹ä¸Šçš„ Function Calling

å¦‚ä½•åœ¨é–‹æº LLM ä¸Šå¯¦ä½œé¡ä¼¼æ©Ÿåˆ¶ï¼ˆå·¥å…·å‘¼å«ã€çµæ§‹åŒ–è¼¸å‡ºç­‰ï¼‰çš„æ•´ç†èˆ‡ç­†è¨˜å°‡åœ¨æœªä¾†è£œå……ã€‚

## Function Calling ä½¿ç”¨æƒ…å¢ƒ

ä»¥ä¸‹æ˜¯å¯å—æƒ æ–¼ LLM function calling èƒ½åŠ›çš„ä½¿ç”¨æƒ…å¢ƒï¼š

- **å°è©±å‹ä»£ç†ï¼ˆConversational Agentsï¼‰**ï¼šå¯ç”¨ä¾†å»ºç«‹è¤‡é›œçš„å°è©±å‹ä»£ç†æˆ–èŠå¤©æ©Ÿå™¨äººï¼Œé€éå‘¼å«å¤–éƒ¨ API æˆ–å¤–éƒ¨çŸ¥è­˜åº«ä¾†å›ç­”è¤‡é›œå•é¡Œï¼Œæä¾›æ›´ç›¸é—œã€å¯¦ç”¨çš„å›è¦†ã€‚

- **è‡ªç„¶èªè¨€ç†è§£ï¼ˆNatural Language Understandingï¼‰**ï¼šå¯å°‡è‡ªç„¶èªè¨€è½‰æˆçµæ§‹åŒ– JSON è³‡æ–™ï¼Œå¾æ–‡å­—å…§å®¹ä¸­æŠ½å–çµæ§‹åŒ–è³‡æ–™ï¼Œä¸¦åŸ·è¡Œå‘½åå¯¦é«”è¾¨è­˜ã€æƒ…æ„Ÿåˆ†æã€é—œéµå­—æ“·å–ç­‰ä»»å‹™ã€‚

- **æ•¸å­¸å•é¡Œæ±‚è§£ï¼ˆMath Problem Solvingï¼‰**ï¼šå¯å®šç¾©è‡ªè¨‚å‡½å¼ï¼Œè™•ç†éœ€è¦å¤šæ­¥é©Ÿèˆ‡é€²éšè¨ˆç®—çš„è¤‡é›œæ•¸å­¸å•é¡Œã€‚

- **API æ•´åˆï¼ˆAPI Integrationï¼‰**ï¼šå¯å°‡ LLM èˆ‡å¤–éƒ¨ API æ•´åˆï¼Œç”¨ä¾†å–å¾—è³‡æ–™æˆ–ä¾è¼¸å…¥åŸ·è¡Œå‹•ä½œã€‚é€™å°æ–¼å»ºæ§‹ QA ç³»çµ±æˆ–å‰µä½œå‹åŠ©ç†éƒ½å¾ˆæœ‰å¹«åŠ©ã€‚æ•´é«”è€Œè¨€ï¼Œfunction calling å¯ä»¥æŠŠè‡ªç„¶èªè¨€è½‰æˆæœ‰æ•ˆçš„ API å‘¼å«ã€‚

- **è³‡è¨Šæ“·å–ï¼ˆInformation Extractionï¼‰**ï¼šå¯ç”¨ä¾†å¾è¼¸å…¥å…§å®¹ä¸­æ“·å–ç‰¹å®šè³‡è¨Šï¼Œä¾‹å¦‚å¾æ–‡ç« ä¸­æ‰¾å‡ºç›¸é—œæ–°èæˆ–å¼•ç”¨ä¾†æºã€‚

## åƒè€ƒè³‡æ–™

- [Fireworks Raises the Quality Bar with Function Calling Model and API Release](https://blog.fireworks.ai/fireworks-raises-the-quality-bar-with-function-calling-model-and-api-release-e7f49d1e98e9)
- [Benchmarking Agent Tool Use and Function Calling](https://blog.langchain.dev/benchmarking-agent-tool-use/)
- [Function Calling](https://ai.google.dev/docs/function_calling)
- [Interacting with APIs](https://python.langchain.com/docs/use_cases/apis)
- [OpenAI's Function Calling](https://platform.openai.com/docs/guides/function-calling)
- [How to call functions with chat models](https://cookbook.openai.com/examples/how_to_call_functions_with_chat_models)
- [Pushing ChatGPT's Structured Data Support To Its Limits](https://minimaxir.com/2023/12/chatgpt-structured-data/)
- [Math Problem Solving with Function Calling](https://github.com/svpino/openai-function-calling/blob/main/sample.ipynb)
